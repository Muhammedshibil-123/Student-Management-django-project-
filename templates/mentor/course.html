{% extends 'base_mentor.html' %}

{% block title %}Course Management{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">Course & Semester Management</h1>

{% if messages %}
  {% for message in messages %}
    <div class="mb-4 px-4 py-3 rounded relative
                {% if message.tags == 'success' %} bg-green-100 border border-green-400 text-green-700
                {% elif message.tags == 'error' %} bg-red-100 border border-red-400 text-red-700
                {% else %} bg-blue-100 border border-blue-400 text-blue-700
                {% endif %}"
         role="alert">
      <span class="block sm:inline">{{ message }}</span>
    </div>
  {% endfor %}
{% endif %}

<div class="bg-white shadow-lg rounded-xl p-6 mb-8 border border-gray-200">
  <h2 class="text-2xl font-semibold text-purple-800 mb-4 border-b border-purple-200 pb-2">Your Assigned Class</h2>
  <dl class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-x-8 gap-y-4 text-gray-700">
    <div>
      <dt class="font-medium text-gray-600">Department</dt>
      <dd class="text-lg">{{ profile.department.name|default:"N/A" }}</dd>
    </div>
    <div>
      <dt class="font-medium text-gray-600">Course</dt>
      <dd class="text-lg">{{ profile.course.name|default:"N/A" }}</dd>
    </div>
    <div>
      <dt class="font-medium text-gray-600">Year</dt>
      <dd class="text-lg">{{ profile.get_year_display|default:"N/A" }}</dd>
    </div>
    <div>
      <dt class="font-medium text-gray-600">Division</dt>
      <dd class="text-lg">{{ profile.get_division_batch_display|default:"N/A" }}</dd>
    </div>
  </dl>
</div>

<form method="POST" class="bg-white shadow-lg rounded-lg overflow-hidden">
    {% csrf_token %}
    {{ formset.management_form }}

    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Student
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 1
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 2
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 3
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 4
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 5
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sem 6
                </th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            
            {% for form in formset %}
            <tr>
                {{ form.id }}

                <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                    {% if form.instance.profile_picture %}
                    <img class="h-10 w-10 rounded-full object-cover" src="{{ form.instance.profile_picture.url }}" alt="Profile Pic">
                    {% else %}
                    <div class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-xs font-medium text-gray-500">
                        No Pic
                    </div>
                    {% endif %}
                    <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                        {{ form.instance.user.first_name }} {{ form.instance.user.last_name }}
                    </div>
                    <div class="text-sm text-gray-500">
                        @{{ form.instance.user.username }}
                    </div>
                    </div>
                </div>
                </td>
                
                <td class="px-4 py-4 whitespace-nowrap">{{ form.semester1_status }} {{ form.semester1_status.errors }}</td>
                <td class="px-4 py-4 whitespace-nowrap">{{ form.semester2_status }} {{ form.semester2_status.errors }}</td>
                <td class="px-4 py-4 whitespace-nowrap">{{ form.semester3_status }} {{ form.semester3_status.errors }}</td>
                <td class="px-4 py-4 whitespace-nowrap">{{ form.semester4_status }} {{ form.semester4_status.errors }}</td>
                <td class="px-4 py-4 whitespace-Nowrap">{{ form.semester5_status }} {{ form.semester5_status.errors }}</td>
                <td class="px-4 py-4 whitespace-nowrap">{{ form.semester6_status }} {{ form.semester6_status.errors }}</td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                You have no approved students in this class.
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% if formset|length > 0 %}
    <div class="flex justify-end p-6 bg-gray-50 border-t border-gray-200">
        <button type="submit" 
                class="px-6 py-2 rounded-md bg-blue-600 text-white font-semibold shadow-sm hover:bg-blue-700 transition-all duration-200">
        Save All Changes
        </button>
    </div>
    {% endif %}

</form>
{% endblock %}